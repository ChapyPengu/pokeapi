<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PokeApi</title>
  </head>
  <body>
    <div id="root"></div>
    <h1>Multiplayer</h1>
    <h2>Select a room or create one</h2>
    <div id="rooms">
        <table>
            <thead>
                <tr>
                    <th>Room</th>
                    <th>Players</th>
                    <th>Join</th>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
    </div>
    
    <script>
        let roomsTable = document.querySelector("#rooms tbody")
        setInterval(async () => {
            const response = await fetch("/rooms")
            const rooms = await response.json()
            roomsTable.innerHTML = ""
            rooms.forEach(obj => {
                const tr = document.createElement("tr")
                const td1 = document.createElement("td")
                const td2 = document.createElement("td")
                const td3 = document.createElement("td")
                td1.textContent = obj.room
                td2.textContent = obj.users
                const joinBtn = document.createElement("button")
                joinBtn.textContent = "Join"
                joinBtn.addEventListener("click", () => {
                    window.location.replace(`http://localhost:8000/multiplayer/${obj.room}`)
                })
                td3.appendChild(joinBtn)
                tr.appendChild(td1)
                tr.appendChild(td2)
                tr.appendChild(td3)
                roomsTable.appendChild(tr)
            })
        }, 5000)
    </script>

    <button type="button" id="create-room">Create Room</button>

    <p id="message"></p>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const createBtn = document.getElementById("create-room")

        const SOCKET = io("/multiplayer")

        SOCKET.on("connect", () => {
            console.log("Connected to server")
        })

        createBtn.addEventListener("click", () => {
            SOCKET.emit("create-room")
        })
    </script>
    <script src="https://kit.fontawesome.com/60642245a2.js" crossorigin="anonymous"></script>
  </body>